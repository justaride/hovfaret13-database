<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>M√∏teoversikt - Hovfaret 13</title>
  <!-- Theme stylesheet loaded by theme-switcher.js -->
  <link rel="stylesheet" href="styles/embedded-reports.css">
  <style>
    /* Meeting Browser Styles */
    .meeting-hero {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
      padding: 3rem 2rem;
      margin-bottom: 2rem;
      border-radius: 12px;
      border: 1px solid rgba(88, 166, 255, 0.2);
    }
    .meeting-hero h1 {
      font-size: 2.5rem;
      margin: 0 0 0.5rem 0;
      color: #fff;
    }
    .meeting-hero-stats {
      color: rgba(255, 255, 255, 0.7);
      font-size: 1.1rem;
      display: flex;
      gap: 2rem;
      flex-wrap: wrap;
    }
    .stat-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .stat-value {
      font-weight: 600;
      color: rgba(88, 166, 255, 1);
    }

    /* Tabs */
    .tab-container {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }
    .tab {
      padding: 1rem 2rem;
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.6);
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: 500;
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s;
    }
    .tab:hover {
      color: rgba(255, 255, 255, 0.9);
    }
    .tab.active {
      color: #fff;
      border-bottom-color: rgba(88, 166, 255, 0.8);
    }

    /* Controls */
    .meeting-controls {
      background: rgba(20, 25, 31, 0.8);
      padding: 1.5rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .search-bar {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .search-input {
      flex: 1;
      padding: 0.75rem 1rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      color: #fff;
      font-size: 1rem;
    }
    .search-input:focus {
      outline: none;
      border-color: rgba(88, 166, 255, 0.6);
      background: rgba(255, 255, 255, 0.08);
    }
    .btn {
      padding: 0.75rem 1.5rem;
      background: rgba(88, 166, 255, 0.2);
      border: 1px solid rgba(88, 166, 255, 0.4);
      border-radius: 6px;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.95rem;
    }
    .btn:hover {
      background: rgba(88, 166, 255, 0.3);
    }
    .filter-bar {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      align-items: center;
    }
    .filter-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .filter-label {
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
    }
    .filter-select {
      padding: 0.5rem 0.75rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      color: #fff;
      font-size: 0.9rem;
      cursor: pointer;
      min-width: 150px;
    }
    .results-info {
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.9rem;
      margin-top: 1rem;
    }

    /* Meeting List */
    .meetings-container {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    /* Month Section */
    .month-section {
      background: rgba(20, 25, 31, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      overflow: hidden;
    }
    .month-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.5rem;
      background: rgba(20, 25, 31, 0.6);
      cursor: pointer;
      transition: all 0.2s;
    }
    .month-header:hover {
      background: rgba(20, 25, 31, 0.8);
    }
    .month-header h3 {
      margin: 0;
      font-size: 1.3rem;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .month-count {
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.9rem;
      font-weight: normal;
    }
    .month-toggle {
      color: rgba(255, 255, 255, 0.4);
      transition: transform 0.2s;
    }
    .month-section.expanded .month-toggle {
      transform: rotate(180deg);
    }
    .month-meetings {
      display: none;
      padding: 1rem;
      gap: 1rem;
      flex-direction: column;
    }
    .month-section.expanded .month-meetings {
      display: flex;
    }

    /* Meeting Card */
    .meeting-card {
      background: rgba(20, 25, 31, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      overflow: hidden;
      transition: all 0.2s;
    }
    .meeting-card:hover {
      background: rgba(20, 25, 31, 0.8);
      border-color: rgba(88, 166, 255, 0.3);
    }
    .meeting-card.past {
      opacity: 0.8;
    }
    .meeting-card.upcoming {
      border-color: rgba(16, 185, 129, 0.3);
    }
    .meeting-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.25rem;
      cursor: pointer;
    }
    .meeting-icon {
      font-size: 1.5rem;
      flex-shrink: 0;
    }
    .meeting-main {
      flex: 1;
      min-width: 0;
    }
    .meeting-date {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 0.25rem;
    }
    .relative-time {
      margin-left: 0.5rem;
      font-style: italic;
    }
    .meeting-title {
      font-size: 1.1rem;
      font-weight: 500;
      color: #fff;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .meeting-indicators {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-shrink: 0;
    }
    .meeting-type-badge {
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 500;
      border: 1px solid;
    }
    .participant-count {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.85rem;
    }
    .participant-count svg {
      opacity: 0.6;
    }
    .data-quality-indicator {
      color: #F59E0B;
      cursor: help;
    }

    /* Meeting Body */
    .meeting-body {
      display: none;
      padding: 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      animation: slideDown 0.2s ease;
    }
    .meeting-card.expanded .meeting-body {
      display: block;
    }
    .meeting-card.expanded .meeting-title {
      white-space: normal;
    }

    /* Meeting Details */
    .meeting-details {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }
    .detail-row {
      display: flex;
      gap: 1rem;
      font-size: 0.9rem;
    }
    .detail-label {
      min-width: 120px;
      color: rgba(255, 255, 255, 0.6);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .detail-label svg {
      opacity: 0.6;
    }
    .detail-value {
      color: #fff;
      flex: 1;
    }
    .detail-value a {
      color: rgba(88, 166, 255, 1);
      text-decoration: none;
    }
    .detail-value a:hover {
      text-decoration: underline;
    }
    .org-tag {
      display: inline-block;
      padding: 0.15rem 0.5rem;
      background: rgba(88, 166, 255, 0.2);
      border: 1px solid rgba(88, 166, 255, 0.4);
      border-radius: 4px;
      font-size: 0.85rem;
      margin-right: 0.5rem;
    }

    /* Participants List */
    .meeting-participants {
      margin-bottom: 1.5rem;
    }
    .meeting-participants h4 {
      color: rgba(255, 255, 255, 0.8);
      margin: 0 0 1rem 0;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .participants-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .participant-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 6px;
    }
    .participant-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 600;
      font-size: 0.85rem;
      flex-shrink: 0;
    }
    .participant-info {
      flex: 1;
      min-width: 0;
    }
    .participant-name {
      color: #fff;
      font-weight: 500;
      font-size: 0.95rem;
    }
    .participant-org {
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.85rem;
    }
    .participant-email {
      color: rgba(88, 166, 255, 1);
      text-decoration: none;
      opacity: 0.6;
      transition: opacity 0.2s;
    }
    .participant-email:hover {
      opacity: 1;
    }
    .no-participants {
      color: rgba(255, 255, 255, 0.5);
      font-style: italic;
      margin: 0;
    }

    /* Meeting Topics */
    .meeting-topics {
      margin-bottom: 1.5rem;
    }
    .meeting-topics h4 {
      color: rgba(255, 255, 255, 0.8);
      margin: 0 0 0.75rem 0;
      font-size: 1rem;
    }
    .meeting-topics ul {
      margin: 0;
      padding-left: 1.5rem;
      color: rgba(255, 255, 255, 0.7);
    }
    .meeting-topics li {
      margin-bottom: 0.5rem;
    }

    /* Data Quality Note */
    .data-quality-note {
      padding: 0.75rem;
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 6px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.9rem;
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
    }
    .data-quality-note strong {
      color: #F59E0B;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: rgba(255, 255, 255, 0.5);
      font-size: 1.1rem;
    }

    /* Loading State */
    .loading-state {
      text-align: center;
      padding: 4rem 2rem;
      color: rgba(255, 255, 255, 0.6);
      font-size: 1.1rem;
    }

    /* Animation */
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .meeting-hero h1 {
        font-size: 2rem;
      }
      .tab {
        padding: 0.75rem 1rem;
        font-size: 1rem;
      }
      .filter-bar {
        flex-direction: column;
        align-items: stretch;
      }
      .filter-group {
        flex-direction: column;
        align-items: stretch;
      }
      .filter-select {
        width: 100%;
      }
      .meeting-indicators {
        flex-direction: column;
        align-items: flex-start;
      }
      .detail-row {
        flex-direction: column;
        gap: 0.25rem;
      }
      .detail-label {
        min-width: auto;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Navigation will be injected here -->
    <div id="navigation"></div>

    <!-- Hero Section -->
    <div class="meeting-hero">
      <h1>üìã M√∏teoversikt</h1>
      <div class="meeting-hero-stats">
        <div class="stat-item">
          <span id="total-meetings">...</span>
          <span>totalt m√∏ter</span>
        </div>
        <div class="stat-item">
          <span id="past-meetings" class="stat-value">...</span>
          <span>avholdte</span>
        </div>
        <div class="stat-item">
          <span id="upcoming-meetings" class="stat-value">...</span>
          <span>kommende</span>
        </div>
        <div class="stat-item">
          <span id="total-participants" class="stat-value">...</span>
          <span>unike deltakere</span>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tab-container">
      <button class="tab active" data-tab="all">Alle M√∏ter</button>
      <button class="tab" data-tab="upcoming">Kommende</button>
      <button class="tab" data-tab="past">Avholdte</button>
    </div>

    <!-- Controls -->
    <div class="meeting-controls">
      <div class="search-bar">
        <input
          type="text"
          class="search-input"
          id="meeting-search"
          placeholder="S√∏k m√∏ter etter tittel, deltaker, organisasjon..."
        >
        <button class="btn" onclick="clearFilters()">Nullstill Filtre</button>
      </div>

      <div class="filter-bar">
        <div class="filter-group">
          <span class="filter-label">Type:</span>
          <select class="filter-select" id="filter-type">
            <option value="all">Alle Typer</option>
          </select>
        </div>

        <div class="filter-group">
          <span class="filter-label">Organisasjon:</span>
          <select class="filter-select" id="filter-organization">
            <option value="all">Alle Organisasjoner</option>
          </select>
        </div>

        <div class="filter-group">
          <span class="filter-label">Deltaker:</span>
          <select class="filter-select" id="filter-participant">
            <option value="all">Alle Deltakere</option>
          </select>
        </div>

        <div class="filter-group">
          <span class="filter-label">Sorter:</span>
          <select class="filter-select" id="sort-by">
            <option value="newest">Nyeste f√∏rst</option>
            <option value="oldest">Eldste f√∏rst</option>
            <option value="title-asc">Tittel (A-√Ö)</option>
            <option value="title-desc">Tittel (√Ö-A)</option>
            <option value="participants">Flest deltakere</option>
          </select>
        </div>
      </div>

      <div class="results-info">
        <span id="results-count">Laster...</span>
      </div>
    </div>

    <!-- Meetings Container -->
    <div id="meetings-container" class="meetings-container">
      <div class="loading-state">Laster m√∏ter...</div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="lib/navigation.js"></script>
  <script src="lib/data-loader.js"></script>
  <script src="lib/meeting-helpers.js"></script>
  <script src="lib/renderer.js"></script>
  <script>
    // Global state
    let allData = {};
    let allMeetings = [];
    let currentTab = 'all';
    let currentFilters = {
      type: 'all',
      organization: 'all',
      participant: 'all',
      timeFilter: null
    };
    let currentSort = 'newest';
    let searchDebounce = null;

    // Initialize
    async function init() {
      // Inject navigation
      Navigation.inject('M√∏teoversikt');

      // Load all data
      try {
        allData = await DataLoader.loadAllData();
        allMeetings = allData.meetings;

        console.log('‚úì Loaded', allMeetings.length, 'meetings');

        // Update statistics
        updateStatistics();

        // Populate filter dropdowns
        populateFilters();

        // Render meetings
        renderMeetings();

        // Setup event listeners
        setupEventListeners();
      } catch (error) {
        console.error('Feil ved lasting av data:', error);
        document.getElementById('meetings-container').innerHTML =
          '<div class="empty-state">Feil ved lasting av m√∏ter. Vennligst oppdater siden.</div>';
      }
    }

    // Update statistics
    function updateStatistics() {
      const stats = DataLoader.getMeetingStatistics(allMeetings);

      document.getElementById('total-meetings').textContent = stats.total;
      document.getElementById('past-meetings').textContent = stats.past;
      document.getElementById('upcoming-meetings').textContent = stats.upcoming;
      document.getElementById('total-participants').textContent = stats.totalParticipants || 0;
    }

    // Populate filter dropdowns
    function populateFilters() {
      // Meeting types
      const types = DataLoader.getUniqueMeetingTypes(allMeetings);
      const typeSelect = document.getElementById('filter-type');
      types.forEach(type => {
        const typeInfo = MeetingHelpers.MEETING_TYPES[type];
        const option = document.createElement('option');
        option.value = type;
        option.textContent = `${typeInfo.icon} ${typeInfo.label}`;
        typeSelect.appendChild(option);
      });

      // Organizations
      const orgs = DataLoader.getUniqueOrganizationsFromMeetings(allMeetings);
      const orgSelect = document.getElementById('filter-organization');
      orgs.forEach(org => {
        const option = document.createElement('option');
        option.value = org;
        option.textContent = org;
        orgSelect.appendChild(option);
      });

      // Participants
      const participants = DataLoader.getUniqueParticipants(allMeetings);
      const participantSelect = document.getElementById('filter-participant');
      participants.forEach(participant => {
        const option = document.createElement('option');
        option.value = participant;
        option.textContent = participant;
        participantSelect.appendChild(option);
      });
    }

    // Render meetings
    function renderMeetings() {
      let meetings = [...allMeetings];

      // Apply tab filter
      if (currentTab === 'past') {
        meetings = DataLoader.getPastMeetings(meetings);
      } else if (currentTab === 'upcoming') {
        meetings = DataLoader.getUpcomingMeetings(meetings);
      }

      // Apply search
      const searchQuery = document.getElementById('meeting-search').value;
      if (searchQuery) {
        meetings = DataLoader.searchMeetings(meetings, searchQuery);
      }

      // Apply filters
      meetings = DataLoader.filterMeetings(meetings, currentFilters);

      // Apply sort
      meetings = DataLoader.sortMeetings(meetings, currentSort);

      // Update results count
      document.getElementById('results-count').textContent =
        `Viser ${meetings.length} av ${allMeetings.length} m√∏ter`;

      // Group by month
      const monthGroups = DataLoader.groupMeetingsByMonth(meetings);

      // Render
      const container = document.getElementById('meetings-container');
      if (meetings.length === 0) {
        container.innerHTML = '<div class="empty-state">Ingen m√∏ter funnet som matcher filtrene dine</div>';
      } else {
        container.innerHTML = Renderer.renderMeetingsByMonth(monthGroups, false);
      }

      // Initialize Lucide icons after rendering
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    }

    // Setup event listeners
    function setupEventListeners() {
      // Tab switching
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          currentTab = tab.dataset.tab;

          // Update timeFilter based on tab
          if (currentTab === 'past') {
            currentFilters.timeFilter = 'past';
          } else if (currentTab === 'upcoming') {
            currentFilters.timeFilter = 'upcoming';
          } else {
            currentFilters.timeFilter = null;
          }

          renderMeetings();
        });
      });

      // Search (debounced)
      document.getElementById('meeting-search').addEventListener('input', () => {
        clearTimeout(searchDebounce);
        searchDebounce = setTimeout(() => {
          renderMeetings();
        }, 300);
      });

      // Filters
      document.getElementById('filter-type').addEventListener('change', (e) => {
        currentFilters.type = e.target.value;
        renderMeetings();
      });

      document.getElementById('filter-organization').addEventListener('change', (e) => {
        currentFilters.organization = e.target.value;
        renderMeetings();
      });

      document.getElementById('filter-participant').addEventListener('change', (e) => {
        currentFilters.participant = e.target.value;
        renderMeetings();
      });

      // Sort
      document.getElementById('sort-by').addEventListener('change', (e) => {
        currentSort = e.target.value;
        renderMeetings();
      });
    }

    // Clear filters
    function clearFilters() {
      document.getElementById('meeting-search').value = '';
      document.getElementById('filter-type').value = 'all';
      document.getElementById('filter-organization').value = 'all';
      document.getElementById('filter-participant').value = 'all';
      document.getElementById('sort-by').value = 'newest';

      currentFilters = {
        type: 'all',
        organization: 'all',
        participant: 'all',
        timeFilter: currentTab === 'past' ? 'past' : (currentTab === 'upcoming' ? 'upcoming' : null)
      };
      currentSort = 'newest';

      renderMeetings();
    }

    // Start
    init();
  </script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    // Initialize Lucide icons after content is rendered
    window.addEventListener('load', () => {
      lucide.createIcons();
    });
  </script>

  <!-- Theme Switcher -->
  <script src="js/theme-switcher.js"></script>
</body>
</html>
