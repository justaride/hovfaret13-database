<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <script>if(sessionStorage.getItem('h13_auth')!=='true')window.location.href='../index.html';</script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Command Center - Hovfaret 13</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
  <style>
    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-main: #f8fafc;
      --bg-card: #ffffff;
      --bg-hover: #f1f5f9;
      --bg-dark: #1e293b;
      --text-primary: #1e293b;
      --text-secondary: #475569;
      --text-muted: #94a3b8;
      --text-white: #ffffff;
      --border-light: #e2e8f0;
      --blue-primary: #2563eb;
      --blue-light: #dbeafe;
      --green-primary: #10b981;
      --green-light: #d1fae5;
      --orange-primary: #f59e0b;
      --orange-light: #fef3c7;
      --purple-primary: #8b5cf6;
      --purple-light: #ede9fe;
      --red-primary: #ef4444;
      --red-light: #fee2e2;
      --cyan-primary: #06b6d4;
      --cyan-light: #cffafe;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-xl: 16px;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-main);
      color: var(--text-primary);
      line-height: 1.5;
      font-size: 14px;
      min-height: 100vh;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, var(--bg-dark) 0%, #334155 100%);
      color: var(--text-white);
      padding: 2rem;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 40%;
      height: 100%;
      background: linear-gradient(135deg, transparent 0%, rgba(37, 99, 235, 0.1) 100%);
      pointer-events: none;
    }

    .header-content {
      max-width: 1600px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }

    .back-link {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: rgba(255,255,255,0.7);
      text-decoration: none;
      font-size: 0.875rem;
      padding: 0.5rem 0.75rem;
      border-radius: var(--radius-sm);
      transition: all 0.15s;
    }

    .back-link:hover {
      background: rgba(255,255,255,0.1);
      color: white;
    }

    .header-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: rgba(16, 185, 129, 0.2);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 20px;
      font-size: 0.8rem;
      color: #6ee7b7;
    }

    .header-title {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .header-subtitle {
      font-size: 1rem;
      color: rgba(255,255,255,0.7);
      max-width: 600px;
    }

    /* Stats Bar */
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .stat-box {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      border-radius: var(--radius-md);
      padding: 1rem;
      text-align: center;
    }

    .stat-value {
      font-size: 1.75rem;
      font-weight: 700;
      color: white;
    }

    .stat-label {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.6);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Horizontal Timeline */
    .h-timeline-container {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: var(--shadow-sm);
      overflow: hidden;
    }

    .h-timeline-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }

    .h-timeline-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.125rem;
      font-weight: 600;
    }

    .h-timeline-dates {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .h-timeline-scroll {
      overflow-x: auto;
      padding-bottom: 1rem;
    }

    .h-timeline {
      display: flex;
      align-items: flex-start;
      min-width: max-content;
      padding: 1rem 0;
      position: relative;
    }

    .h-timeline::before {
      content: '';
      position: absolute;
      top: 50px;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--green-primary), var(--blue-primary), var(--purple-primary));
      border-radius: 2px;
    }

    .h-timeline-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 140px;
      padding: 0 0.5rem;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .h-timeline-item:hover {
      transform: translateY(-4px);
    }

    .h-timeline-item.milestone {
      min-width: 180px;
    }

    .h-timeline-date {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .h-timeline-dot {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--bg-card);
      border: 3px solid var(--blue-primary);
      margin-bottom: 0.75rem;
      position: relative;
      z-index: 2;
      transition: all 0.2s;
    }

    .h-timeline-item:hover .h-timeline-dot {
      transform: scale(1.3);
      background: var(--blue-primary);
    }

    .h-timeline-item.milestone .h-timeline-dot {
      width: 24px;
      height: 24px;
      border-width: 4px;
      border-color: var(--green-primary);
    }

    .h-timeline-item.milestone:hover .h-timeline-dot {
      background: var(--green-primary);
    }

    .h-timeline-item.current .h-timeline-dot {
      background: var(--orange-primary);
      border-color: var(--orange-primary);
      animation: pulse-dot 2s infinite;
    }

    @keyframes pulse-dot {
      0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
      50% { box-shadow: 0 0 0 8px rgba(245, 158, 11, 0); }
    }

    .h-timeline-content {
      text-align: center;
      max-width: 160px;
    }

    .h-timeline-item.milestone .h-timeline-content {
      max-width: 200px;
    }

    .h-timeline-event {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--text-primary);
      line-height: 1.3;
      margin-bottom: 0.25rem;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .h-timeline-meta {
      font-size: 0.65rem;
      color: var(--text-muted);
    }

    .h-timeline-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.125rem 0.5rem;
      background: var(--green-light);
      color: var(--green-primary);
      border-radius: 10px;
      font-size: 0.6rem;
      font-weight: 600;
      margin-top: 0.25rem;
    }

    .h-timeline-year-marker {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-width: 80px;
      padding: 0 1rem;
    }

    .h-timeline-year {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .h-timeline-year-line {
      width: 2px;
      height: 60px;
      background: var(--border-light);
    }

    /* Main Content */
    .main-content {
      max-width: 1600px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Section */
    .section {
      margin-bottom: 2rem;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.125rem;
      font-weight: 600;
    }

    .section-icon {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-md);
      font-size: 1rem;
    }

    .section-icon.blue { background: var(--blue-light); }
    .section-icon.green { background: var(--green-light); }
    .section-icon.orange { background: var(--orange-light); }
    .section-icon.purple { background: var(--purple-light); }
    .section-icon.cyan { background: var(--cyan-light); }
    .section-icon.red { background: var(--red-light); }

    .section-link {
      font-size: 0.8rem;
      color: var(--blue-primary);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .section-link:hover {
      text-decoration: underline;
    }

    /* Status Grid - 3 columns */
    .status-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
    }

    @media (max-width: 1200px) {
      .status-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Status Card */
    .status-card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      overflow: hidden;
    }

    .status-card-header {
      padding: 1rem 1.25rem;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .status-card-icon {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
    }

    .status-card-title {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .status-card-badge {
      margin-left: auto;
      padding: 0.25rem 0.625rem;
      background: var(--green-light);
      color: var(--green-primary);
      border-radius: 20px;
      font-size: 0.7rem;
      font-weight: 600;
    }

    .status-card-content {
      padding: 1.25rem;
      max-height: 350px;
      overflow-y: auto;
    }

    /* Timeline */
    .timeline {
      position: relative;
      padding-left: 1.5rem;
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 6px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--border-light);
    }

    .timeline-item {
      position: relative;
      padding-bottom: 1.25rem;
    }

    .timeline-item:last-child {
      padding-bottom: 0;
    }

    .timeline-dot {
      position: absolute;
      left: -1.5rem;
      top: 2px;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      border: 3px solid var(--blue-primary);
      background: white;
    }

    .timeline-dot.active {
      background: var(--blue-primary);
    }

    .timeline-dot.completed {
      background: var(--green-primary);
      border-color: var(--green-primary);
    }

    .timeline-dot.upcoming {
      border-color: var(--orange-primary);
    }

    .timeline-date {
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.25rem;
    }

    .timeline-title {
      font-weight: 500;
      font-size: 0.875rem;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .timeline-desc {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    /* Item List */
    .item-list {
      display: flex;
      flex-direction: column;
      gap: 0.625rem;
    }

    .item-row {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem;
      background: var(--bg-main);
      border-radius: var(--radius-sm);
      transition: all 0.15s;
    }

    .item-row:hover {
      background: var(--bg-hover);
    }

    .item-bullet {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-top: 5px;
      flex-shrink: 0;
    }

    .item-bullet.green { background: var(--green-primary); }
    .item-bullet.blue { background: var(--blue-primary); }
    .item-bullet.orange { background: var(--orange-primary); }
    .item-bullet.red { background: var(--red-primary); }
    .item-bullet.purple { background: var(--purple-primary); }

    .item-content {
      flex: 1;
      min-width: 0;
    }

    .item-text {
      font-size: 0.85rem;
      color: var(--text-primary);
      line-height: 1.4;
    }

    .item-meta {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    /* Category Grid */
    .category-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 0.75rem;
    }

    .category-card {
      background: var(--bg-main);
      border-radius: var(--radius-md);
      padding: 1rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.15s;
      border: 2px solid transparent;
    }

    .category-card:hover {
      border-color: var(--blue-primary);
      transform: translateY(-2px);
    }

    .category-card.selected {
      border-color: var(--blue-primary);
      background: var(--blue-light);
    }

    .category-count {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--blue-primary);
    }

    .category-name {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-top: 0.25rem;
    }

    /* Phase Progress */
    .phase-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .phase-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.875rem;
      background: var(--bg-main);
      border-radius: var(--radius-md);
    }

    .phase-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .phase-indicator.completed { background: var(--green-primary); }
    .phase-indicator.active { background: var(--blue-primary); animation: pulse 2s infinite; }
    .phase-indicator.upcoming { background: var(--border-light); }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .phase-info {
      flex: 1;
    }

    .phase-name {
      font-weight: 500;
      font-size: 0.85rem;
    }

    .phase-dates {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .phase-stats {
      text-align: right;
    }

    .phase-meetings {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--blue-primary);
    }

    .phase-decisions {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    /* Resource Links */
    .resource-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
    }

    .resource-card {
      display: flex;
      align-items: center;
      gap: 0.875rem;
      padding: 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      text-decoration: none;
      color: var(--text-primary);
      transition: all 0.15s;
    }

    .resource-card:hover {
      border-color: var(--blue-primary);
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .resource-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-md);
      font-size: 1.125rem;
      flex-shrink: 0;
    }

    .resource-info {
      flex: 1;
      min-width: 0;
    }

    .resource-name {
      font-weight: 600;
      font-size: 0.875rem;
      margin-bottom: 0.125rem;
    }

    .resource-count {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Quick Actions */
    .quick-actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .quick-action {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.625rem 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      font-size: 0.8rem;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.15s;
    }

    .quick-action:hover {
      border-color: var(--blue-primary);
      color: var(--blue-primary);
      background: var(--blue-light);
    }

    /* Organization chips */
    .org-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .org-chip {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.375rem 0.75rem;
      background: var(--bg-main);
      border-radius: 20px;
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .org-chip-count {
      background: var(--blue-light);
      color: var(--blue-primary);
      padding: 0.125rem 0.375rem;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.65rem;
    }

    /* Loading */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem;
      color: var(--text-muted);
    }

    .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--border-light);
      border-top-color: var(--blue-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-bottom: 1rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border-light);
      border-radius: 3px;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .stats-bar {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 768px) {
      .stats-bar {
        grid-template-columns: repeat(2, 1fr);
      }

      .header-title {
        font-size: 1.5rem;
      }
    }
  </style>
    <script src="auth.js"></script>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="header-top">
        <a href="index.html" class="back-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Dashboard
        </a>
        <div class="header-badge">
          <span>‚óè</span>
          Aktiv prosjektfase
        </div>
      </div>
      <h1 class="header-title">Hovfaret 13 - Command Center</h1>
      <p class="header-subtitle">
        Komplett oversikt over prosjektets diskusjoner, beslutninger, prosesser og status
      </p>

      <div class="stats-bar" id="stats-bar">
        <div class="stat-box">
          <div class="stat-value" id="stat-meetings">-</div>
          <div class="stat-label">M√∏ter</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="stat-decisions">-</div>
          <div class="stat-label">Beslutninger</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="stat-actions">-</div>
          <div class="stat-label">Handlingspunkter</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="stat-topics">-</div>
          <div class="stat-label">Temaer</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="stat-orgs">-</div>
          <div class="stat-label">Organisasjoner</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="stat-people">-</div>
          <div class="stat-label">Deltakere</div>
        </div>
      </div>
    </div>
  </header>

  <main class="main-content">
    <!-- Horizontal Timeline -->
    <div class="h-timeline-container">
      <div class="h-timeline-header">
        <div class="h-timeline-title">
          <span style="font-size: 1.25rem;">üìà</span>
          Prosjektreise
        </div>
        <div class="h-timeline-dates" id="timeline-dates">Juni 2023 ‚Üí I dag</div>
      </div>
      <div class="h-timeline-scroll">
        <div class="h-timeline" id="h-timeline">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </div>
    </div>

    <!-- Status Now / What's Happening / What's Next -->
    <section class="section">
      <div class="section-header">
        <div class="section-title">
          <div class="section-icon blue">üìä</div>
          Prosjektstatus
        </div>
      </div>
      <div class="status-grid">
        <!-- What has happened -->
        <div class="status-card">
          <div class="status-card-header">
            <div class="status-card-icon" style="background: var(--green-light);">‚úì</div>
            <div class="status-card-title">Hva har skjedd</div>
            <div class="status-card-badge" id="completed-count">0</div>
          </div>
          <div class="status-card-content">
            <div class="item-list" id="completed-list">
              <div class="loading"><div class="spinner"></div></div>
            </div>
          </div>
        </div>

        <!-- What's happening now -->
        <div class="status-card">
          <div class="status-card-header">
            <div class="status-card-icon" style="background: var(--blue-light);">‚ö°</div>
            <div class="status-card-title">Hva skjer n√•</div>
            <div class="status-card-badge" style="background: var(--blue-light); color: var(--blue-primary);" id="current-count">0</div>
          </div>
          <div class="status-card-content">
            <div class="item-list" id="current-list">
              <div class="loading"><div class="spinner"></div></div>
            </div>
          </div>
        </div>

        <!-- What's coming -->
        <div class="status-card">
          <div class="status-card-header">
            <div class="status-card-icon" style="background: var(--orange-light);">üéØ</div>
            <div class="status-card-title">Hva skal skje</div>
            <div class="status-card-badge" style="background: var(--orange-light); color: var(--orange-primary);" id="upcoming-count">0</div>
          </div>
          <div class="status-card-content">
            <div class="item-list" id="upcoming-list">
              <div class="loading"><div class="spinner"></div></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Project Phases -->
    <section class="section">
      <div class="section-header">
        <div class="section-title">
          <div class="section-icon purple">üìÖ</div>
          Prosjektfaser
        </div>
        <a href="timeline.html" class="section-link">
          Se full tidslinje ‚Üí
        </a>
      </div>
      <div class="status-card">
        <div class="status-card-content">
          <div class="phase-list" id="phase-list">
            <div class="loading"><div class="spinner"></div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Categories / Topics -->
    <section class="section">
      <div class="section-header">
        <div class="section-title">
          <div class="section-icon cyan">üí¨</div>
          Temaer og kategorier
        </div>
      </div>
      <div class="status-card">
        <div class="status-card-content">
          <div class="category-grid" id="category-grid">
            <div class="loading"><div class="spinner"></div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Recent Decisions -->
    <section class="section">
      <div class="section-header">
        <div class="section-title">
          <div class="section-icon green">‚úÖ</div>
          Siste beslutninger
        </div>
        <a href="meetings.html" class="section-link">
          Se alle m√∏ter ‚Üí
        </a>
      </div>
      <div class="status-card">
        <div class="status-card-content">
          <div class="item-list" id="decisions-list">
            <div class="loading"><div class="spinner"></div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Organizations -->
    <section class="section">
      <div class="section-header">
        <div class="section-title">
          <div class="section-icon orange">üè¢</div>
          Involverte organisasjoner
        </div>
        <a href="stakeholders.html" class="section-link">
          Se alle interessenter ‚Üí
        </a>
      </div>
      <div class="status-card">
        <div class="status-card-content">
          <div class="org-chips" id="org-chips">
            <div class="loading"><div class="spinner"></div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Resource Links -->
    <section class="section">
      <div class="section-header">
        <div class="section-title">
          <div class="section-icon red">üîó</div>
          Prosjektressurser
        </div>
      </div>
      <div class="resource-grid">
        <a href="meetings.html" class="resource-card">
          <div class="resource-icon" style="background: var(--blue-light);">üìÖ</div>
          <div class="resource-info">
            <div class="resource-name">M√∏ter</div>
            <div class="resource-count" id="resource-meetings">- m√∏ter</div>
          </div>
        </a>
        <a href="documents.html" class="resource-card">
          <div class="resource-icon" style="background: var(--green-light);">üìÑ</div>
          <div class="resource-info">
            <div class="resource-name">Dokumenter</div>
            <div class="resource-count" id="resource-documents">- dokumenter</div>
          </div>
        </a>
        <a href="stakeholders.html" class="resource-card">
          <div class="resource-icon" style="background: var(--purple-light);">üë•</div>
          <div class="resource-info">
            <div class="resource-name">Interessenter</div>
            <div class="resource-count" id="resource-stakeholders">- personer</div>
          </div>
        </a>
        <a href="timeline.html" class="resource-card">
          <div class="resource-icon" style="background: var(--orange-light);">üìà</div>
          <div class="resource-info">
            <div class="resource-name">Tidslinje</div>
            <div class="resource-count">Prosjekthistorikk</div>
          </div>
        </a>
        <a href="scenarios.html" class="resource-card">
          <div class="resource-icon" style="background: var(--cyan-light);">üèóÔ∏è</div>
          <div class="resource-info">
            <div class="resource-name">Scenarier</div>
            <div class="resource-count">3 alternativer</div>
          </div>
        </a>
        <a href="sustainability.html" class="resource-card">
          <div class="resource-icon" style="background: var(--green-light);">üå±</div>
          <div class="resource-info">
            <div class="resource-name">B√¶rekraft</div>
            <div class="resource-count">-48% CO‚ÇÇ</div>
          </div>
        </a>
        <a href="analytics.html" class="resource-card">
          <div class="resource-icon" style="background: var(--red-light);">üìä</div>
          <div class="resource-info">
            <div class="resource-name">Analyse</div>
            <div class="resource-count">Statistikk</div>
          </div>
        </a>
        <a href="overview.html" class="resource-card">
          <div class="resource-icon" style="background: var(--purple-light);">üéØ</div>
          <div class="resource-info">
            <div class="resource-name">Oversikt</div>
            <div class="resource-count">Dashboard</div>
          </div>
        </a>
      </div>
    </section>
  </main>

  <script src="lib/data-loader.js"></script>
  <script>
    let allMeetings = [];
    let allDocuments = [];
    let allPeople = [];

    async function init() {
      try {
        const data = await DataLoader.loadAllData();
        allMeetings = data.meetings || [];
        allDocuments = data.documents || [];
        allPeople = data.people ? Object.values(data.people) : [];

        renderStats();
        renderHorizontalTimeline();
        renderPhases();
        renderCategories();
        renderStatusCards();
        renderDecisions();
        renderOrganizations();
        renderResourceCounts();
      } catch (error) {
        console.error('Feil ved lasting:', error);
      }
    }

    function renderHorizontalTimeline() {
      const sortedMeetings = [...allMeetings]
        .filter(m => m.date)
        .sort((a, b) => a.date.localeCompare(b.date));

      if (sortedMeetings.length === 0) return;

      // Identifiser milep√¶ler
      const isMilestone = (m) => {
        const title = (m.title || '').toLowerCase();
        const decisions = m.decisions?.length || 0;
        if (title.includes('strategi')) return true;
        if (title.includes('konsept')) return true;
        if (title.includes('workshop')) return true;
        if (title.includes('bydel') || title.includes('kommune')) return true;
        if (decisions >= 4) return true;
        return false;
      };

      // Velg ut viktige hendelser (ikke alle 65)
      const keyEvents = [];
      let currentYear = null;
      let lastAddedMonth = null;

      sortedMeetings.forEach((m, index) => {
        const year = m.date.substring(0, 4);
        const month = m.date.substring(0, 7);
        const milestone = isMilestone(m);

        // Legg til √•rsmark√∏r
        if (year !== currentYear) {
          keyEvents.push({ type: 'year', year: year });
          currentYear = year;
          lastAddedMonth = null;
        }

        // Legg til milep√¶ler alltid
        if (milestone) {
          keyEvents.push({ type: 'event', meeting: m, milestone: true });
          lastAddedMonth = month;
        }
        // Eller f√∏rste m√∏te i ny m√•ned hvis det ikke er for tett
        else if (month !== lastAddedMonth && keyEvents.length < 30) {
          keyEvents.push({ type: 'event', meeting: m, milestone: false });
          lastAddedMonth = month;
        }
      });

      // Oppdater datoer
      const firstDate = sortedMeetings[0].date;
      const lastDate = sortedMeetings[sortedMeetings.length - 1].date;
      document.getElementById('timeline-dates').textContent =
        `${formatMonth(firstDate)} ‚Üí ${formatMonth(lastDate)} (${sortedMeetings.length} m√∏ter)`;

      // Render tidslinje
      const container = document.getElementById('h-timeline');
      container.innerHTML = keyEvents.map(item => {
        if (item.type === 'year') {
          return `
            <div class="h-timeline-year-marker">
              <div class="h-timeline-year">${item.year}</div>
              <div class="h-timeline-year-line"></div>
            </div>
          `;
        }

        const m = item.meeting;
        const decisions = m.decisions?.length || 0;
        const isLast = m.date === lastDate;

        return `
          <div class="h-timeline-item ${item.milestone ? 'milestone' : ''} ${isLast ? 'current' : ''}"
               onclick="window.location.href='meetings.html?id=${m.id}'">
            <div class="h-timeline-date">${formatShortDate(m.date)}</div>
            <div class="h-timeline-dot"></div>
            <div class="h-timeline-content">
              <div class="h-timeline-event">${sanitize(m.title)}</div>
              <div class="h-timeline-meta">${m.participants?.length || 0} deltakere</div>
              ${decisions > 0 ? `<div class="h-timeline-badge">‚úì ${decisions} beslutninger</div>` : ''}
            </div>
          </div>
        `;
      }).join('');
    }

    function formatMonth(dateStr) {
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Des'];
      const [year, month] = dateStr.split('-');
      return `${months[parseInt(month) - 1]} ${year}`;
    }

    function formatShortDate(dateStr) {
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Des'];
      const [year, month, day] = dateStr.split('-');
      return `${parseInt(day)} ${months[parseInt(month) - 1]}`;
    }

    function renderStats() {
      const topics = allMeetings.flatMap(m => m.topics_discussed || []);
      const decisions = allMeetings.flatMap(m => m.decisions || []);
      const actions = allMeetings.flatMap(m => m.action_items || []);
      const orgs = new Set(allMeetings.flatMap(m => (m.participants || []).map(p => p.organization).filter(Boolean)));
      const people = new Set(allMeetings.flatMap(m => (m.participants || []).map(p => p.name).filter(Boolean)));

      document.getElementById('stat-meetings').textContent = allMeetings.length;
      document.getElementById('stat-decisions').textContent = decisions.length;
      document.getElementById('stat-actions').textContent = actions.length;
      document.getElementById('stat-topics').textContent = topics.length;
      document.getElementById('stat-orgs').textContent = orgs.size;
      document.getElementById('stat-people').textContent = people.size;
    }

    function renderPhases() {
      const phases = [
        { name: '2023 - Oppstart', start: '2023-01', end: '2023-12', status: 'completed' },
        { name: '2024 Q1-Q2 - Utredning', start: '2024-01', end: '2024-06', status: 'completed' },
        { name: '2024 Q3-Q4 - Konseptutvikling', start: '2024-07', end: '2024-12', status: 'completed' },
        { name: '2025 Q1-Q2 - Detaljering', start: '2025-01', end: '2025-06', status: 'completed' },
        { name: '2025 Q3+ - Beslutning & S√∏knad', start: '2025-07', end: '2025-12', status: 'active' },
      ];

      phases.forEach(phase => {
        const phaseMeetings = allMeetings.filter(m => {
          const date = m.date?.substring(0, 7) || '';
          return date >= phase.start && date <= phase.end;
        });
        phase.meetings = phaseMeetings.length;
        phase.decisions = phaseMeetings.reduce((sum, m) => sum + (m.decisions?.length || 0), 0);
      });

      const container = document.getElementById('phase-list');
      container.innerHTML = phases.map(phase => `
        <div class="phase-item">
          <div class="phase-indicator ${phase.status}"></div>
          <div class="phase-info">
            <div class="phase-name">${phase.name}</div>
            <div class="phase-dates">${phase.start} ‚Üí ${phase.end}</div>
          </div>
          <div class="phase-stats">
            <div class="phase-meetings">${phase.meetings} m√∏ter</div>
            <div class="phase-decisions">${phase.decisions} beslutninger</div>
          </div>
        </div>
      `).join('');
    }

    function renderCategories() {
      const categories = {
        'B√¶rekraft & Milj√∏': { icon: 'üå±', count: 0 },
        'Arkitektur & Design': { icon: 'üèõÔ∏è', count: 0 },
        'Regulering & Kommune': { icon: 'üìã', count: 0 },
        '√òkonomi & Strategi': { icon: 'üí∞', count: 0 },
        'Teknikk & Bygg': { icon: 'üîß', count: 0 },
        'Prosjektstyring': { icon: 'üìä', count: 0 },
      };

      allMeetings.forEach(m => {
        const title = (m.title + ' ' + (m.topics_discussed || []).join(' ')).toLowerCase();
        if (title.match(/b√¶rekraft|klima|co2|energi|milj√∏|sirkul√¶r|lca/)) categories['B√¶rekraft & Milj√∏'].count++;
        else if (title.match(/arkitekt|design|fasade|r21|tegning|skisse/)) categories['Arkitektur & Design'].count++;
        else if (title.match(/kommune|plan|reguler|bydel|ullern|pbe/)) categories['Regulering & Kommune'].count++;
        else if (title.match(/√∏konomi|invester|kostnad|strategi|business/)) categories['√òkonomi & Strategi'].count++;
        else if (title.match(/teknisk|konstruksjon|bygg|fundament|statikk/)) categories['Teknikk & Bygg'].count++;
        else categories['Prosjektstyring'].count++;
      });

      const container = document.getElementById('category-grid');
      container.innerHTML = Object.entries(categories)
        .sort((a, b) => b[1].count - a[1].count)
        .map(([name, data]) => `
          <div class="category-card" onclick="filterByCategory('${name}')">
            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">${data.icon}</div>
            <div class="category-count">${data.count}</div>
            <div class="category-name">${name}</div>
          </div>
        `).join('');
    }

    function renderStatusCards() {
      const today = new Date();
      const threeMonthsAgo = new Date(today);
      threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);

      const sortedMeetings = [...allMeetings].sort((a, b) => (b.date || '').localeCompare(a.date || ''));

      // Hva har skjedd - siste 3 m√•neder beslutninger
      const completedItems = [];
      sortedMeetings.forEach(m => {
        if (!m.date) return;
        const mDate = new Date(m.date);
        if (mDate <= today && mDate >= threeMonthsAgo) {
          (m.decisions || []).forEach(d => {
            completedItems.push({ text: d, date: m.date, meeting: m.title });
          });
        }
      });

      document.getElementById('completed-count').textContent = completedItems.length;
      document.getElementById('completed-list').innerHTML = completedItems.slice(0, 8).map(item => `
        <div class="item-row">
          <div class="item-bullet green"></div>
          <div class="item-content">
            <div class="item-text">${sanitize(item.text)}</div>
            <div class="item-meta">${item.date} - ${sanitize(item.meeting)}</div>
          </div>
        </div>
      `).join('') || '<div style="color: var(--text-muted); text-align: center; padding: 1rem;">Ingen data</div>';

      // Hva skjer n√• - action items fra siste m√∏ter
      const currentItems = [];
      sortedMeetings.slice(0, 5).forEach(m => {
        (m.action_items || []).forEach(a => {
          const task = typeof a === 'string' ? a : a.task || a;
          currentItems.push({ text: task, date: m.date, meeting: m.title });
        });
      });

      document.getElementById('current-count').textContent = currentItems.length;
      document.getElementById('current-list').innerHTML = currentItems.slice(0, 8).map(item => `
        <div class="item-row">
          <div class="item-bullet blue"></div>
          <div class="item-content">
            <div class="item-text">${sanitize(item.text)}</div>
            <div class="item-meta">${item.date}</div>
          </div>
        </div>
      `).join('') || '<div style="color: var(--text-muted); text-align: center; padding: 1rem;">Ingen aktive oppgaver</div>';

      // Hva skal skje - fremtidige m√∏ter eller planlagte aktiviteter
      const upcomingItems = [
        { text: 'Ferdigstille b√¶rekraftsrapport med klimadel', date: 'P√•g√•ende' },
        { text: 'Oppdatere nettside med tydeligere budskap', date: 'Planlagt' },
        { text: 'Energikartlegging og ombrukskartlegging - s√∏ke st√∏tte', date: 'Planlagt' },
        { text: 'Interessentoversikt over nabolaget', date: 'Planlagt' },
        { text: 'Rammes√∏knad koordinering', date: 'P√•g√•ende' },
      ];

      document.getElementById('upcoming-count').textContent = upcomingItems.length;
      document.getElementById('upcoming-list').innerHTML = upcomingItems.map(item => `
        <div class="item-row">
          <div class="item-bullet orange"></div>
          <div class="item-content">
            <div class="item-text">${sanitize(item.text)}</div>
            <div class="item-meta">${item.date}</div>
          </div>
        </div>
      `).join('');
    }

    function renderDecisions() {
      const allDecisions = [];
      allMeetings.forEach(m => {
        (m.decisions || []).forEach(d => {
          allDecisions.push({ text: d, date: m.date, meeting: m.title });
        });
      });

      allDecisions.sort((a, b) => (b.date || '').localeCompare(a.date || ''));

      const container = document.getElementById('decisions-list');
      container.innerHTML = allDecisions.slice(0, 10).map(d => `
        <div class="item-row">
          <div class="item-bullet green"></div>
          <div class="item-content">
            <div class="item-text">${sanitize(d.text)}</div>
            <div class="item-meta">${d.date} - ${sanitize(d.meeting)}</div>
          </div>
        </div>
      `).join('');
    }

    function renderOrganizations() {
      const orgCount = {};
      allMeetings.forEach(m => {
        (m.participants || []).forEach(p => {
          const org = p.organization;
          if (org && org !== 'Ukjent') {
            orgCount[org] = (orgCount[org] || 0) + 1;
          }
        });
      });

      const sorted = Object.entries(orgCount).sort((a, b) => b[1] - a[1]);

      const container = document.getElementById('org-chips');
      container.innerHTML = sorted.map(([org, count]) => `
        <div class="org-chip">
          ${sanitize(org)}
          <span class="org-chip-count">${count}</span>
        </div>
      `).join('');
    }

    function renderResourceCounts() {
      document.getElementById('resource-meetings').textContent = `${allMeetings.length} m√∏ter`;
      document.getElementById('resource-documents').textContent = `${allDocuments.length} dokumenter`;
      document.getElementById('resource-stakeholders').textContent = `${allPeople.length || 40} personer`;
    }

    function sanitize(str) {
      if (!str) return '';
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    function filterByCategory(category) {
      // Could redirect to meetings page with filter
      window.location.href = `meetings.html?category=${encodeURIComponent(category)}`;
    }

    init();
  </script>
</body>
</html>
