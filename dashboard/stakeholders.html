<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Interessenter - 23 nÃ¸kkelpersoner og 16 organisasjoner involvert i Hovfaret 13">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interessenter - Hovfaret 13</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
  <style>
    /* ===== RESET & BASE ===== */
    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-main: #f8fafc;
      --bg-card: #ffffff;
      --bg-hover: #f1f5f9;
      --bg-selected: #eff6ff;
      --bg-accent: #dbeafe;

      --text-primary: #1e293b;
      --text-secondary: #475569;
      --text-muted: #94a3b8;
      --text-accent: #2563eb;

      --border-light: #e2e8f0;
      --border-medium: #cbd5e1;

      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;

      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);

      --space-1: 0.25rem;
      --space-2: 0.5rem;
      --space-3: 0.75rem;
      --space-4: 1rem;
      --space-5: 1.25rem;
      --space-6: 1.5rem;
      --space-8: 2rem;

      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 12px;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-main);
      color: var(--text-primary);
      line-height: 1.5;
      font-size: 14px;
      height: 100vh;
      overflow: hidden;
    }

    /* ===== LAYOUT ===== */
    .app-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    /* Header */
    .app-header {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-light);
      padding: var(--space-4) var(--space-6);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: var(--space-4);
    }

    .back-link {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.875rem;
      padding: var(--space-2) var(--space-3);
      border-radius: var(--radius-sm);
      transition: all 0.15s;
    }

    .back-link:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .page-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .header-stats {
      display: flex;
      gap: var(--space-6);
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-accent);
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Main Content */
    .main-content {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* ===== LEFT PANEL - LIST ===== */
    .list-panel {
      width: 420px;
      min-width: 420px;
      background: var(--bg-card);
      border-right: 1px solid var(--border-light);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .list-controls {
      padding: var(--space-4);
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-card);
    }

    .search-container {
      position: relative;
      margin-bottom: var(--space-3);
    }

    .search-icon {
      position: absolute;
      left: var(--space-3);
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      pointer-events: none;
    }

    .search-input {
      width: 100%;
      padding: var(--space-3) var(--space-3) var(--space-3) 2.5rem;
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      transition: all 0.15s;
      background: var(--bg-main);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--text-accent);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      background: var(--bg-card);
    }

    .tab-row {
      display: flex;
      gap: var(--space-2);
      margin-bottom: var(--space-3);
    }

    .tab-btn {
      flex: 1;
      padding: var(--space-2) var(--space-3);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      font-size: 0.8rem;
      color: var(--text-secondary);
      background: var(--bg-card);
      cursor: pointer;
      transition: all 0.15s;
    }

    .tab-btn:hover {
      background: var(--bg-hover);
    }

    .tab-btn.active {
      background: var(--bg-accent);
      border-color: var(--text-accent);
      color: var(--text-accent);
    }

    .filter-row {
      display: flex;
      gap: var(--space-2);
    }

    .filter-select {
      flex: 1;
      padding: var(--space-2) var(--space-3);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      font-size: 0.8rem;
      color: var(--text-secondary);
      background: var(--bg-card);
      cursor: pointer;
    }

    .filter-select:focus {
      outline: none;
      border-color: var(--text-accent);
    }

    .results-info {
      padding: var(--space-2) var(--space-4);
      background: var(--bg-main);
      border-bottom: 1px solid var(--border-light);
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Item List */
    .item-list {
      flex: 1;
      overflow-y: auto;
      padding: var(--space-2);
    }

    .category-group {
      margin-bottom: var(--space-4);
    }

    .category-header {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2) var(--space-3);
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      position: sticky;
      top: 0;
      background: var(--bg-main);
      z-index: 10;
    }

    .category-count {
      background: var(--border-light);
      padding: 2px 8px;
      border-radius: 10px;
      font-weight: 500;
    }

    .stakeholder-item {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-3);
      margin: var(--space-1) 0;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all 0.15s;
      border: 1px solid transparent;
    }

    .stakeholder-item:hover {
      background: var(--bg-hover);
    }

    .stakeholder-item.selected {
      background: var(--bg-selected);
      border-color: var(--text-accent);
    }

    .stakeholder-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.875rem;
      color: white;
      flex-shrink: 0;
    }

    .stakeholder-content {
      flex: 1;
      min-width: 0;
    }

    .stakeholder-name {
      font-weight: 500;
      color: var(--text-primary);
      font-size: 0.9rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .stakeholder-meta {
      font-size: 0.75rem;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .org-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      flex-shrink: 0;
      background: var(--bg-main);
      border: 1px solid var(--border-light);
    }

    /* ===== RIGHT PANEL - DETAIL VIEW ===== */
    .detail-panel {
      flex: 1;
      overflow-y: auto;
      background: var(--bg-main);
    }

    .detail-empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--text-muted);
      text-align: center;
      padding: var(--space-8);
    }

    .detail-empty-icon {
      font-size: 4rem;
      margin-bottom: var(--space-4);
      opacity: 0.3;
    }

    .detail-empty h3 {
      font-size: 1.25rem;
      color: var(--text-secondary);
      margin-bottom: var(--space-2);
    }

    .detail-content {
      max-width: 800px;
      margin: 0 auto;
      padding: var(--space-6);
    }

    .detail-header {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: var(--space-6);
      margin-bottom: var(--space-4);
      box-shadow: var(--shadow-sm);
      display: flex;
      gap: var(--space-5);
    }

    .detail-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.75rem;
      color: white;
      flex-shrink: 0;
    }

    .detail-org-icon {
      width: 80px;
      height: 80px;
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      flex-shrink: 0;
      background: var(--bg-main);
      border: 1px solid var(--border-light);
    }

    .detail-info {
      flex: 1;
    }

    .detail-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--space-2);
    }

    .detail-subtitle {
      font-size: 1rem;
      color: var(--text-secondary);
      margin-bottom: var(--space-1);
    }

    .detail-org {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .category-badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: var(--radius-sm);
      font-size: 0.75rem;
      font-weight: 500;
      margin-top: var(--space-3);
    }

    /* Detail Sections */
    .detail-section {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      margin-bottom: var(--space-4);
      box-shadow: var(--shadow-sm);
      overflow: hidden;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-4) var(--space-5);
      background: var(--bg-card);
      cursor: pointer;
      transition: background 0.15s;
      border-bottom: 1px solid transparent;
    }

    .section-header:hover {
      background: var(--bg-hover);
    }

    .detail-section.expanded .section-header {
      border-bottom-color: var(--border-light);
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--text-primary);
    }

    .section-title svg {
      color: var(--text-accent);
    }

    .section-toggle {
      color: var(--text-muted);
      transition: transform 0.2s;
    }

    .detail-section.expanded .section-toggle {
      transform: rotate(180deg);
    }

    .section-content {
      display: none;
      padding: var(--space-5);
    }

    .detail-section.expanded .section-content {
      display: block;
    }

    /* Contact Info */
    .contact-row {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-3);
      background: var(--bg-main);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-2);
    }

    .contact-icon {
      width: 32px;
      height: 32px;
      background: var(--bg-accent);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-accent);
    }

    .contact-info {
      flex: 1;
    }

    .contact-label {
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .contact-value {
      font-size: 0.875rem;
      color: var(--text-primary);
    }

    .contact-value a {
      color: var(--text-accent);
      text-decoration: none;
    }

    .contact-value a:hover {
      text-decoration: underline;
    }

    /* Bio */
    .bio-text {
      color: var(--text-secondary);
      line-height: 1.7;
      font-size: 0.9rem;
    }

    /* Meeting List */
    .meeting-item {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-3);
      background: var(--bg-main);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-2);
    }

    .meeting-date {
      min-width: 60px;
      text-align: center;
      padding: var(--space-2);
      background: var(--bg-card);
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-light);
    }

    .meeting-date-day {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .meeting-date-month {
      font-size: 0.65rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .meeting-title {
      font-weight: 500;
      color: var(--text-primary);
      font-size: 0.875rem;
    }

    /* Person in org */
    .person-item {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-3);
      background: var(--bg-main);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-2);
    }

    .person-avatar-small {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.75rem;
      color: white;
    }

    .person-info {
      flex: 1;
    }

    .person-name-small {
      font-weight: 500;
      color: var(--text-primary);
      font-size: 0.875rem;
    }

    .person-title-small {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Loading State */
    .loading-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--space-8);
      color: var(--text-muted);
    }

    .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--border-light);
      border-top-color: var(--text-accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-bottom: var(--space-4);
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border-medium);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-muted);
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .list-panel {
        width: 360px;
        min-width: 360px;
      }
    }

    @media (max-width: 768px) {
      .main-content {
        flex-direction: column;
      }

      .list-panel {
        width: 100%;
        min-width: 100%;
        max-height: 50vh;
      }

      .detail-panel {
        border-top: 1px solid var(--border-light);
      }

      .header-stats {
        display: none;
      }

      .detail-header {
        flex-direction: column;
        align-items: center;
        text-align: center;
      }
    }
  
    /* Print styles */
    @media print {
        body { background: white !important; color: black !important; }
        .nav, .nav-bar, .header-nav, nav, .back-link, .auth-overlay, 
        .copy-btn, button:not([type="submit"]), .design-switcher,
        .hamburger, .mobile-menu { display: none !important; }
        .container, .app-container, main { 
            max-width: 100% !important; 
            margin: 0 !important; 
            padding: 1rem !important;
        }
        a { color: black !important; text-decoration: underline !important; }
        .card, .section, .slide-card { 
            break-inside: avoid !important;
            box-shadow: none !important;
            border: 1px solid #ddd !important;
        }
        * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
    }

  </style>
    
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="app-header">
      <div class="header-left">
        <a href="index.html" class="back-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Dashboard
        </a>
        <h1 class="page-title">Interessenter</h1>
      </div>
      <div class="header-stats">
        <div class="stat">
          <div class="stat-value" id="stat-people">-</div>
          <div class="stat-label">Personer</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="stat-orgs">-</div>
          <div class="stat-label">Organisasjoner</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="stat-categories">-</div>
          <div class="stat-label">Kategorier</div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Left Panel: List -->
      <aside class="list-panel">
        <div class="list-controls">
          <div class="search-container">
            <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="m21 21-4.35-4.35"/>
            </svg>
            <input type="text" class="search-input" id="search-input" placeholder="SÃ¸k etter navn, rolle, organisasjon...">
          </div>
          <div class="tab-row">
            <button class="tab-btn active" id="tab-people" onclick="switchTab('people')">Personer</button>
            <button class="tab-btn" id="tab-orgs" onclick="switchTab('orgs')">Organisasjoner</button>
          </div>
          <div class="filter-row">
            <select class="filter-select" id="filter-category">
              <option value="all">Alle kategorier</option>
            </select>
          </div>
        </div>
        <div class="results-info" id="results-info">Laster interessenter...</div>
        <div class="item-list" id="item-list">
          <div class="loading-state">
            <div class="spinner"></div>
            <span>Laster interessenter...</span>
          </div>
        </div>
      </aside>

      <!-- Right Panel: Detail View -->
      <section class="detail-panel" id="detail-panel">
        <div class="detail-empty">
          <div class="detail-empty-icon">ðŸ‘¥</div>
          <h3>Velg en interessent</h3>
          <p>Velg en person eller organisasjon fra listen for Ã¥ se detaljer</p>
        </div>
      </section>
    </main>
  </div>

  <!-- Scripts -->
  <script src="lib/data-loader.js"></script>
  <script>
    // ===== STATE =====
    let allPeople = [];
    let allOrgs = [];
    let allMeetings = [];
    let filteredItems = [];
    let selectedId = null;
    let currentTab = 'people';
    let searchQuery = '';
    let categoryFilter = 'all';

    // ===== HELPERS =====
    function getInitials(name) {
      if (!name) return '?';
      return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
    }

    function getAvatarColor(name) {
      if (!name) return '#6b7280';
      const colors = ['#8b5cf6', '#0ea5e9', '#10b981', '#f59e0b', '#ef4444', '#ec4899', '#6366f1'];
      let hash = 0;
      for (let i = 0; i < name.length; i++) {
        hash = name.charCodeAt(i) + ((hash << 5) - hash);
      }
      return colors[Math.abs(hash) % colors.length];
    }

    function getCategoryColor(category) {
      const colors = {
        'Prosjekteier': { bg: 'rgba(139, 92, 246, 0.15)', color: '#8b5cf6' },
        'Arkitekt': { bg: 'rgba(14, 165, 233, 0.15)', color: '#0ea5e9' },
        'Konsulent': { bg: 'rgba(16, 185, 129, 0.15)', color: '#10b981' },
        'RÃ¥dgiver': { bg: 'rgba(245, 158, 11, 0.15)', color: '#f59e0b' },
        'Myndighet': { bg: 'rgba(239, 68, 68, 0.15)', color: '#ef4444' },
        'EntreprenÃ¸r': { bg: 'rgba(236, 72, 153, 0.15)', color: '#ec4899' },
        'LeverandÃ¸r': { bg: 'rgba(99, 102, 241, 0.15)', color: '#6366f1' },
        'default': { bg: 'rgba(107, 114, 128, 0.15)', color: '#6b7280' }
      };
      return colors[category] || colors['default'];
    }

    function getOrgIcon(type) {
      const icons = {
        'developer': 'ðŸ—ï¸',
        'architect': 'ðŸ“',
        'consultant': 'ðŸ’¼',
        'authority': 'ðŸ›ï¸',
        'contractor': 'ðŸ”§',
        'owner': 'ðŸ¢',
        'default': 'ðŸ '
      };
      return icons[type] || icons['default'];
    }

    function sanitize(str) {
      if (!str) return '';
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    function formatDateShort(dateStr) {
      if (!dateStr) return { day: '-', month: '-' };
      const date = new Date(dateStr);
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Des'];
      return {
        day: date.getDate(),
        month: months[date.getMonth()]
      };
    }

    // ===== FILTERING =====
    function applyFilters() {
      let items = currentTab === 'people' ? [...allPeople] : [...allOrgs];

      // Search
      if (searchQuery) {
        const query = searchQuery.toLowerCase();
        if (currentTab === 'people') {
          items = items.filter(p =>
            (p.name || '').toLowerCase().includes(query) ||
            (p.title || '').toLowerCase().includes(query) ||
            (p.organization || '').toLowerCase().includes(query) ||
            (p.category || '').toLowerCase().includes(query)
          );
        } else {
          items = items.filter(o =>
            (o.name || '').toLowerCase().includes(query) ||
            (o.type || '').toLowerCase().includes(query) ||
            (o.role || '').toLowerCase().includes(query)
          );
        }
      }

      // Category filter
      if (categoryFilter !== 'all') {
        items = items.filter(i => i.category === categoryFilter);
      }

      // Sort alphabetically
      items.sort((a, b) => (a.name || '').localeCompare(b.name || ''));

      filteredItems = items;
      renderList();
    }

    function switchTab(tab) {
      currentTab = tab;
      selectedId = null;

      // Update tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById(`tab-${tab}`).classList.add('active');

      // Update category filter options
      updateCategoryFilter();

      // Reset detail panel
      document.getElementById('detail-panel').innerHTML = `
        <div class="detail-empty">
          <div class="detail-empty-icon">ðŸ‘¥</div>
          <h3>Velg en interessent</h3>
          <p>Velg en ${tab === 'people' ? 'person' : 'organisasjon'} fra listen for Ã¥ se detaljer</p>
        </div>
      `;

      applyFilters();
    }

    function updateCategoryFilter() {
      const select = document.getElementById('filter-category');
      const items = currentTab === 'people' ? allPeople : allOrgs;
      const categories = [...new Set(items.map(i => i.category).filter(Boolean))].sort();

      select.innerHTML = '<option value="all">Alle kategorier</option>';
      categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        select.appendChild(option);
      });
    }

    // ===== RENDERING =====
    function renderList() {
      const container = document.getElementById('item-list');
      const resultsInfo = document.getElementById('results-info');
      const total = currentTab === 'people' ? allPeople.length : allOrgs.length;

      resultsInfo.textContent = `Viser ${filteredItems.length} av ${total} ${currentTab === 'people' ? 'personer' : 'organisasjoner'}`;

      if (filteredItems.length === 0) {
        container.innerHTML = '<div class="loading-state"><span>Ingen resultater funnet</span></div>';
        return;
      }

      // Group by category
      const groups = {};
      filteredItems.forEach(item => {
        const category = item.category || 'Ukategorisert';
        if (!groups[category]) {
          groups[category] = [];
        }
        groups[category].push(item);
      });

      let html = '';
      Object.keys(groups).sort().forEach(category => {
        html += `
          <div class="category-group">
            <div class="category-header">
              <span>${category}</span>
              <span class="category-count">${groups[category].length}</span>
            </div>
            ${groups[category].map(item => currentTab === 'people' ? renderPersonItem(item) : renderOrgItem(item)).join('')}
          </div>
        `;
      });

      container.innerHTML = html;

      // Add click handlers
      container.querySelectorAll('.stakeholder-item').forEach(item => {
        item.addEventListener('click', () => {
          selectItem(item.dataset.id);
        });
      });

      // Re-select if needed
      if (selectedId) {
        const selectedItem = container.querySelector(`[data-id="${selectedId}"]`);
        if (selectedItem) {
          selectedItem.classList.add('selected');
        }
      }
    }

    function renderPersonItem(person) {
      const isSelected = person.id === selectedId;
      const avatarColor = getAvatarColor(person.name);

      return `
        <div class="stakeholder-item ${isSelected ? 'selected' : ''}" data-id="${person.id}">
          <div class="stakeholder-avatar" style="background-color: ${avatarColor}">
            ${getInitials(person.name)}
          </div>
          <div class="stakeholder-content">
            <div class="stakeholder-name">${sanitize(person.name)}</div>
            <div class="stakeholder-meta">${sanitize(person.title || '')} ${person.organization ? 'â€¢ ' + sanitize(person.organization) : ''}</div>
          </div>
        </div>
      `;
    }

    function renderOrgItem(org) {
      const isSelected = org.id === selectedId;

      return `
        <div class="stakeholder-item ${isSelected ? 'selected' : ''}" data-id="${org.id}">
          <div class="org-icon">${getOrgIcon(org.type)}</div>
          <div class="stakeholder-content">
            <div class="stakeholder-name">${sanitize(org.name)}</div>
            <div class="stakeholder-meta">${sanitize(org.role || org.type || '')}</div>
          </div>
        </div>
      `;
    }

    function selectItem(itemId) {
      selectedId = itemId;

      // Update list selection
      document.querySelectorAll('.stakeholder-item').forEach(item => {
        item.classList.toggle('selected', item.dataset.id === itemId);
      });

      // Render detail
      if (currentTab === 'people') {
        const person = allPeople.find(p => p.id === itemId);
        if (person) renderPersonDetail(person);
      } else {
        const org = allOrgs.find(o => o.id === itemId);
        if (org) renderOrgDetail(org);
      }
    }

    function renderPersonDetail(person) {
      const panel = document.getElementById('detail-panel');
      const avatarColor = getAvatarColor(person.name);
      const catColor = getCategoryColor(person.category);

      // Find meetings this person attended
      const personMeetings = allMeetings.filter(m =>
        (m.participants || []).some(p => p.name === person.name || p.email === person.email)
      ).slice(0, 10);

      let html = `
        <div class="detail-content">
          <div class="detail-header">
            <div class="detail-avatar" style="background-color: ${avatarColor}">
              ${getInitials(person.name)}
            </div>
            <div class="detail-info">
              <h2 class="detail-title">${sanitize(person.name)}</h2>
              ${person.title ? `<div class="detail-subtitle">${sanitize(person.title)}</div>` : ''}
              ${person.organization ? `<div class="detail-org">${sanitize(person.organization)}</div>` : ''}
              ${person.category ? `
                <span class="category-badge" style="background: ${catColor.bg}; color: ${catColor.color}">
                  ${sanitize(person.category)}
                </span>
              ` : ''}
            </div>
          </div>

          <!-- Contact Info -->
          ${person.email || person.phone ? `
            <div class="detail-section expanded">
              <div class="section-header" onclick="toggleSection(this)">
                <span class="section-title">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                    <polyline points="22,6 12,13 2,6"/>
                  </svg>
                  Kontaktinformasjon
                </span>
                <svg class="section-toggle" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"/>
                </svg>
              </div>
              <div class="section-content">
                ${person.email ? `
                  <div class="contact-row">
                    <div class="contact-icon">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                        <polyline points="22,6 12,13 2,6"/>
                      </svg>
                    </div>
                    <div class="contact-info">
                      <div class="contact-label">E-post</div>
                      <div class="contact-value"><a href="mailto:${person.email}">${sanitize(person.email)}</a></div>
                    </div>
                  </div>
                ` : ''}
                ${person.phone ? `
                  <div class="contact-row">
                    <div class="contact-icon">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                      </svg>
                    </div>
                    <div class="contact-info">
                      <div class="contact-label">Telefon</div>
                      <div class="contact-value"><a href="tel:${person.phone}">${sanitize(person.phone)}</a></div>
                    </div>
                  </div>
                ` : ''}
              </div>
            </div>
          ` : ''}

          <!-- Bio -->
          ${person.bio ? `
            <div class="detail-section">
              <div class="section-header" onclick="toggleSection(this)">
                <span class="section-title">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                  </svg>
                  Om
                </span>
                <svg class="section-toggle" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"/>
                </svg>
              </div>
              <div class="section-content">
                <p class="bio-text">${sanitize(person.bio)}</p>
              </div>
            </div>
          ` : ''}

          <!-- Meetings -->
          ${personMeetings.length > 0 ? `
            <div class="detail-section">
              <div class="section-header" onclick="toggleSection(this)">
                <span class="section-title">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                  </svg>
                  Deltatt i mÃ¸ter
                  <span style="background: var(--bg-main); padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; color: var(--text-muted); font-weight: 500;">${personMeetings.length}</span>
                </span>
                <svg class="section-toggle" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"/>
                </svg>
              </div>
              <div class="section-content">
                ${personMeetings.map(m => {
                  const dateInfo = formatDateShort(m.date);
                  return `
                    <div class="meeting-item">
                      <div class="meeting-date">
                        <div class="meeting-date-day">${dateInfo.day}</div>
                        <div class="meeting-date-month">${dateInfo.month}</div>
                      </div>
                      <span class="meeting-title">${sanitize(m.title)}</span>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          ` : ''}
        </div>
      `;

      panel.innerHTML = html;
    }

    function renderOrgDetail(org) {
      const panel = document.getElementById('detail-panel');
      const catColor = getCategoryColor(org.category);

      // Find people in this org
      const orgPeople = allPeople.filter(p => p.organization === org.name);

      let html = `
        <div class="detail-content">
          <div class="detail-header">
            <div class="detail-org-icon">${getOrgIcon(org.type)}</div>
            <div class="detail-info">
              <h2 class="detail-title">${sanitize(org.name)}</h2>
              ${org.role ? `<div class="detail-subtitle">${sanitize(org.role)}</div>` : ''}
              ${org.type ? `<div class="detail-org">${sanitize(org.type)}</div>` : ''}
              ${org.category ? `
                <span class="category-badge" style="background: ${catColor.bg}; color: ${catColor.color}">
                  ${sanitize(org.category)}
                </span>
              ` : ''}
            </div>
          </div>

          <!-- Description -->
          ${org.description ? `
            <div class="detail-section expanded">
              <div class="section-header" onclick="toggleSection(this)">
                <span class="section-title">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="16" x2="12" y2="12"/>
                    <line x1="12" y1="8" x2="12.01" y2="8"/>
                  </svg>
                  Om organisasjonen
                </span>
                <svg class="section-toggle" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"/>
                </svg>
              </div>
              <div class="section-content">
                <p class="bio-text">${sanitize(org.description)}</p>
              </div>
            </div>
          ` : ''}

          <!-- People in org -->
          ${orgPeople.length > 0 ? `
            <div class="detail-section expanded">
              <div class="section-header" onclick="toggleSection(this)">
                <span class="section-title">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                  </svg>
                  Personer
                  <span style="background: var(--bg-main); padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; color: var(--text-muted); font-weight: 500;">${orgPeople.length}</span>
                </span>
                <svg class="section-toggle" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"/>
                </svg>
              </div>
              <div class="section-content">
                ${orgPeople.map(p => `
                  <div class="person-item">
                    <div class="person-avatar-small" style="background-color: ${getAvatarColor(p.name)}">
                      ${getInitials(p.name)}
                    </div>
                    <div class="person-info">
                      <div class="person-name-small">${sanitize(p.name)}</div>
                      ${p.title ? `<div class="person-title-small">${sanitize(p.title)}</div>` : ''}
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          ` : ''}

          <!-- Contact -->
          ${org.website || org.address ? `
            <div class="detail-section">
              <div class="section-header" onclick="toggleSection(this)">
                <span class="section-title">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="2" y1="12" x2="22" y2="12"/>
                    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                  </svg>
                  Kontakt
                </span>
                <svg class="section-toggle" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"/>
                </svg>
              </div>
              <div class="section-content">
                ${org.website ? `
                  <div class="contact-row">
                    <div class="contact-icon">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="2" y1="12" x2="22" y2="12"/>
                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                      </svg>
                    </div>
                    <div class="contact-info">
                      <div class="contact-label">Nettside</div>
                      <div class="contact-value"><a href="${org.website}" target="_blank">${sanitize(org.website)}</a></div>
                    </div>
                  </div>
                ` : ''}
                ${org.address ? `
                  <div class="contact-row">
                    <div class="contact-icon">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                        <circle cx="12" cy="10" r="3"/>
                      </svg>
                    </div>
                    <div class="contact-info">
                      <div class="contact-label">Adresse</div>
                      <div class="contact-value">${sanitize(org.address)}</div>
                    </div>
                  </div>
                ` : ''}
              </div>
            </div>
          ` : ''}
        </div>
      `;

      panel.innerHTML = html;
    }

    function toggleSection(header) {
      const section = header.parentElement;
      section.classList.toggle('expanded');
    }

    // ===== INITIALIZATION =====
    async function init() {
      try {
        const data = await DataLoader.loadAllData();

        // Convert people and orgs from object to array
        allPeople = DataLoader.getPeopleArray ? DataLoader.getPeopleArray(data.people) : Object.values(data.people || {});
        allOrgs = DataLoader.getOrganizationsArray ? DataLoader.getOrganizationsArray(data.organizations) : Object.values(data.organizations || {});
        allMeetings = data.meetings || [];

        // Update stats
        document.getElementById('stat-people').textContent = allPeople.length;
        document.getElementById('stat-orgs').textContent = allOrgs.length;

        const allCategories = new Set([
          ...allPeople.map(p => p.category).filter(Boolean),
          ...allOrgs.map(o => o.category).filter(Boolean)
        ]);
        document.getElementById('stat-categories').textContent = allCategories.size;

        // Initialize category filter
        updateCategoryFilter();

        // Apply initial filters
        applyFilters();

        // Setup event listeners
        setupEventListeners();

        // Auto-select first item
        if (filteredItems.length > 0) {
          selectItem(filteredItems[0].id);
        }

      } catch (error) {
        console.error('Error loading data:', error);
        document.getElementById('item-list').innerHTML =
          '<div class="loading-state"><span>Feil ved lasting av interessenter</span></div>';
      }
    }

    function setupEventListeners() {
      // Search
      let searchTimeout;
      document.getElementById('search-input').addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          searchQuery = e.target.value;
          applyFilters();
        }, 200);
      });

      // Category filter
      document.getElementById('filter-category').addEventListener('change', (e) => {
        categoryFilter = e.target.value;
        applyFilters();
      });
    }

    // Start
    init();
  </script>
</body>
</html>
